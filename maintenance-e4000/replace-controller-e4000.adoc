---
permalink: maintenance-e4000/replace-controller-e4000.html 
sidebar: sidebar 
keywords:  
summary:  
---
= 更換 E4000 中的控制器
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以更換故障的控制器容器。

.開始之前
請確定您擁有下列項目：

* 更換控制器機箱的零件編號與您要更換的控制器機箱相同。
* 或您已採取其他防靜電預防措施。
* 用於識別連接至控制器容器的每條纜線的標籤。
* 1號十字螺絲起子。
* 管理站、具備瀏覽器、可存取SANtricity 控制器的《系統管理程式》。（若要開啟System Manager介面、請將瀏覽器指向控制器的網域名稱或IP位址。）




== 步驟1：準備更換控制器

儲存磁碟機安全金鑰、備份組態及收集支援資料、以準備更換控制器機箱。然後，您可以停止主機 I/O 作業，並將控制器離線或關機。

[role="tabbed-block"]
====
.關閉控制器機櫃電源（單工）
--
.步驟
. 如有可能、請記下SANtricity 控制器上目前安裝的是哪個版本的作業系統軟體。開啟 SANtricity System Manager 並選取 * 支援›升級中心›檢視軟體與韌體庫存 * 。
. 如果已啟用「磁碟機安全性」功能、請確定已儲存金鑰存在、而且您知道安裝金鑰所需的密碼。
+

CAUTION: * 資料存取可能中斷 * —如果儲存陣列中的所有磁碟機都已啟用安全功能，則新控制器將無法存取儲存陣列，除非您使用 SANtricity Storage Manager 中的「企業管理」視窗來解除鎖定受保護的磁碟機。

+
若要儲存金鑰（視控制器狀態而定、可能無法儲存金鑰）：

+
.. 從 SANtricity 系統管理員中、選取 * 設定›系統 * 。
.. 在*磁碟機安全金鑰管理*下、選取*備份金鑰*。
.. 在*定義密碼/重新輸入密碼*欄位中、輸入並確認此備份複本的密碼。
.. 按一下*備份*。
.. 將金鑰資訊記錄在安全位置、然後按一下*關閉*。


. 使用SANtricity NetApp System Manager備份儲存陣列的組態資料庫。
+
如果移除控制器時發生問題、您可以使用儲存的檔案來還原組態。系統會儲存RAID組態資料庫的目前狀態、其中包含控制器上磁碟區群組和磁碟集區的所有資料。

+
** 從系統管理員：
+
... * 選擇支援›支援中心›診斷 * 。
... 選擇*收集組態資料*。
... 按一下「* Collect*」。
+
檔案會以*組態Data-<arrayName>-<DateTimer>.7z*的名稱儲存在瀏覽器的「下載」資料夾中。



** 或者、您也可以使用下列CLI命令來備份組態資料庫：
+
「ave storageArray dbmDatabase sourceLocation=Onboard contentID=all file="File"；」



. 使用SANtricity NetApp System Manager收集儲存陣列的支援資料。
+
如果移除控制器時發生問題、您可以使用儲存的檔案來疑難排解問題。系統會將儲存陣列的庫存、狀態和效能資料儲存在單一檔案中。

+
.. * 選擇支援›支援中心›診斷 * 。
.. 選擇*收集支援資料*。
.. 按一下「* Collect*」。
+
檔案會以* support-data.7z*的名稱儲存在瀏覽器的「下載」資料夾中。



. 確保儲存陣列與所有連線的主機之間不會發生I/O作業。例如、您可以執行下列步驟：
+
** 停止所有涉及從儲存設備對應至主機之LUN的程序。
** 確保沒有任何應用程式將資料寫入從儲存設備對應至主機的任何LUN。
** 卸載陣列上與磁碟區相關的所有檔案系統。
+

NOTE: 停止主機I/O作業的確切步驟取決於主機作業系統和組態、而這些步驟超出這些指示的範圍。如果您不確定如何停止環境中的主機I/O作業、請考慮關閉主機。

+

CAUTION: * 可能的資料遺失 * —如果您在 I/O 作業期間繼續執行此程序，可能會遺失資料。



. 等待快取記憶體中的任何資料寫入磁碟機。
+
當需要將快取資料寫入磁碟機時、控制器背面的綠色快取作用中LED會亮起。您必須等待此LED燈關閉。

. 從「SView System Manager」首頁SANtricity 選取*「View Operations in progress*」。
. 請確認所有作業均已完成、然後再繼續下一步。
. 關閉控制器機櫃上的兩個電源開關。
. 等待控制器機櫃上的所有LED關閉。
. 從Recovery Guru中選取* Recheck*、然後確認「詳細資料」區域中的「*確定要移除*」欄位顯示*是*、表示移除此元件是安全的。除非您更換控制器容器、否則無法存取儲存陣列上的資料。


--
.使控制器離線（雙工）
--
.步驟
. 打開新控制器容器的包裝、將其放置在無靜電的平面上。
+
保存包裝材料、以便在運送故障控制器容器時使用。

. 找出控制器容器背面的MAC位址和FRU零件編號標籤。
. 從「系統管理程式」找到您要更換的控制器機箱的更換零件編號。SANtricity
+
當控制器發生故障且需要更換時、替換零件編號會顯示在Recovery Guru的「Details（詳細資料）」區域中。如果您需要手動尋找此號碼、請依照下列步驟操作：

+
.. 選取*硬體*。
.. 找到標有控制器圖示的控制器機櫃。
.. 按一下控制器圖示。
.. 選取控制器、然後按一下*「下一步*」。
.. 在「*基礎*」索引標籤上、記下控制器的*更換零件編號*。


. 確認故障控制器的更換零件編號與更換控制器的FRU零件編號相同。
+

CAUTION: * 資料存取可能遺失 * —如果兩個零件編號不同，請勿嘗試執行此程序。當您將新控制器上線時，若控制器出現不相符的情形，將會導致新控制器鎖定。

. 使用SANtricity NetApp System Manager備份儲存陣列的組態資料庫。
+
如果移除控制器時發生問題、您可以使用儲存的檔案來還原組態。系統會儲存RAID組態資料庫的目前狀態、其中包含控制器上磁碟區群組和磁碟集區的所有資料。

+
** 從系統管理員：
+
... 選擇 * 支援›支援中心›診斷 * 。
... 選擇*收集組態資料*。
... 按一下「* Collect*」。
+
檔案會以*組態Data-<arrayName>-<DateTimer>.7z*的名稱儲存在瀏覽器的「下載」資料夾中。



** 或者、您也可以使用下列CLI命令來備份組態資料庫：
+
[listing]
----
save storageArray dbmDatabase sourceLocation=onboard contentType=all file="filename";
----


. 如果控制器尚未離線、請使用SANtricity 「系統管理程式」將其離線。
+
** 從《系統管理程式》：SANtricity
+
... 選取*硬體*。
... 如果圖形顯示磁碟機、請選取*顯示磁碟櫃背面*以顯示控制器。
... 選取您要離線的控制器。
... 從內容功能表中選取*離線*、然後確認您要執行此作業。
+

NOTE: 如果您使用SANtricity 嘗試離線的控制器來存取「無法使用」功能、SANtricity 就會顯示「無法使用」訊息。選取「連線到其他網路連線」，以使用其他控制器自動存取 SANtricity 系統管理員。



** 或者、您也可以使用下列CLI命令將控制器離線：
+
* 對於控制器 A* ： `set controller [a] availability=offline`

+
* 對於控制器 B* ： `set controller [b] availability=offline`



. 等候SANtricity 「更新」功能將控制器狀態更新為「離線」。
+

CAUTION: 在更新狀態之前、請勿開始任何其他作業。

. 從Recovery Guru中選取* Recheck*、然後確認「詳細資料」區域中的「*確定要移除*」欄位顯示*是*、表示移除此元件是安全的。


--
====


== 步驟2：移除故障的控制器

請以新的容器來更換故障的容器。

.步驟
. 移除控制器容器。
+
.. 放置於防靜電腕帶上或採取其他防靜電預防措施。
.. 標示連接至控制器容器的每條纜線。
.. 從控制器容器拔下所有纜線。
+

CAUTION: 為避免效能降低、請勿扭轉、摺疊、夾緊或踏上纜線。

.. 如有需要，請移除 SFP 收發器。
.. 確認控制器背面的快取作用中LED已關閉。
+
當需要將快取資料寫入磁碟機時、控制器背面的綠色快取作用中LED會亮起。您必須等到LED燈關閉後、才能移除控制器機箱。

.. 壓下凸輪把手上的閂鎖、直到鬆開為止、完全打開凸輪把手、從中間背板釋放控制器圓筒、然後用雙手將控制器圓筒拉出機箱。
.. 將控制器圓筒翻轉過來、放在平穩的平面上。
.. 按下控制器圓筒兩側的藍色按鈕以打開蓋子、然後向上或向外旋轉控制器圓筒的蓋子。






== 步驟 3 ：取出電池

從受損的控制器中取出電池，並將其安裝在更換的控制器中。

.步驟
. 從控制器電池箱中取出電池：
+
.. 按下控制器圓筒側邊的藍色按鈕。
.. 將電池向上滑動、直到其脫離固定支架、然後將電池從控制器圓筒中取出。
.. 擠壓電池插頭正面的固定夾、將插頭從插槽中拔下、然後從插槽拔下電池纜線。
+
image::../media/drw_E4000_replace_nvbattery_IEOPS-862.png[取出電池。]

+
|===


 a| 
image::../media/legend_icon_01.png[單一圖示]
| 電池釋放彈片 


 a| 
image::../media/legend_icon_02.png[兩個圖示]
| 電池電源接頭 
|===


. 將電池移至更換的控制器圓筒並安裝：
+
.. 將電池與金屬板側壁上的固定支架對齊。
.. 向下滑動電池組、直到電池卡榫卡入、然後卡入側牆的開口。
+

NOTE: 請勿插入電池。將其餘元件移至更換控制器圓筒之後、您就可以將其插入。







== 步驟4：移除HIC

從受損的控制器模組中取出 HIC 擋板和 PCIe HIC 卡。

.步驟
. 將 HIC 擋板直接從控制器模組滑出，以將其卸下。
+
image::../media/drw_E4000_replace_HIC_source_IEOPS-864.png[從控制器模組中移除 HIC 。]

. 鬆開 HIC 上的指旋螺絲。
+

NOTE: 您可以用手指或螺絲起子鬆開指旋螺絲。

. 垂直提起 HIC ，並將其放在防靜電表面上。




== 步驟 5 ：移動 DIMM

從受損的控制器圓筒中取出 DIMM 、並將其安裝到更換的控制器圓筒中。

.步驟
. 找到控制器圓筒上的 DIMM 。
+

NOTE: 請注意 DIMM 在插槽中的位置、以便您可以將 DIMM 插入更換控制器圓筒中的相同位置、並以正確的方向插入。從受損的控制器容器中取出 DIMM ：

+
.. 慢慢地將 DIMM 兩側的兩個 DIMM 彈出彈片往外推、將 DIMM 從插槽中退出。
+
DIMM 會稍微向上旋轉。

.. 儘量旋轉 DIMM 、然後將 DIMM 滑出插槽。
+

NOTE: 小心拿住DIMM的邊緣、避免對DIMM電路板上的元件施加壓力。

+
image::../media/drw_E4000_replace_dimms_IEOPS-865.png[移除 DIMM 。]

+
|===


 a| 
image::../media/legend_icon_01.png[單一圖示]
| DIMM推出式彈片 


 a| 
image::../media/legend_icon_02.png[兩個圖示]
| DIMM 
|===


. 確認電池未插入更換的控制器圓筒。
. 將 DIMM 安裝在替換控制器中、其位置與受損控制器相同：
+
.. 在DIMM頂端邊緣小心地推入、但穩固地推入、直到彈出彈出彈片卡入DIMM兩端的槽口。
+
DIMM可緊密插入插槽、但應該很容易就能裝入。如果沒有、請重新將DIMM與插槽對齊、然後重新插入。

+

NOTE: 目視檢查DIMM、確認其對齊並完全插入插槽。



. 對其他 DIMM 重複這些步驟。




== 步驟6：安裝HIC

將 HIC 安裝到更換的控制器圓筒中。

.步驟
. 將替換 HIC 插頭上的插槽對準主機板上的插槽，然後將插卡輕輕平齊插槽。
. 鎖緊 HIC 上的三個指旋螺絲。
. 重新安裝 HIC 面板。




== 步驟 7 ：安裝電池

將電池裝入更換的控制器容器中。

.步驟
. 將電池插頭插回控制器圓筒上的插槽。
+
請確定插頭已鎖入主機板上的電池插槽。

. 將電池與金屬板側壁上的固定支架對齊。
. 向下滑動電池組、直到電池卡榫卡入、然後卡入側牆的開口。
. 重新安裝控制器圓筒蓋並將其鎖定到位。




== 步驟8：完成控制器更換

重新連線至控制器機櫃，收集支援資料並恢復作業。

[role="tabbed-block"]
====
.開啟控制器機櫃電源（單工）
--
.步驟
. 將替換控制器安裝到設備中。
+
.. 翻轉控制器、使可拆式護蓋面朝下。
.. 將CAM握把放在開啟位置、將控制器完全滑入產品。
.. 將CAM握把往左移動、將控制器鎖定到位。
.. 更換纜線。
.. 開啟控制器機櫃電源。
.. 等待 E4000 控制器重新開機。
.. 確定如何將IP位址指派給更換的控制器。
+

NOTE: 將 IP 位址指派給替換控制器的步驟、取決於您是否使用 DHCP 伺服器將管理連接埠連接到網路、以及是否所有磁碟機都受到保護。

+
如果管理連接埠1連線至具有DHCP伺服器的網路、新控制器將從DHCP伺服器取得其IP位址。此值可能與原始控制器的IP位址不同。



. 如果儲存陣列有安全磁碟機、請匯入磁碟機安全金鑰；否則、請執行下一步。請依照下列適當程序、以處理所有安全磁碟機的儲存陣列、或是混合使用安全磁碟機和不安全磁碟機的儲存陣列。
+

NOTE: _不安全磁碟機_是未指派的磁碟機、全域熱備援磁碟機、或是磁碟區群組或集區中未受磁碟機安全功能保護的磁碟機。安全磁碟機是指派給屬於安全磁碟區群組或磁碟集區的磁碟機、使用磁碟機安全性。

+
** *僅限安全磁碟機（無不安全磁碟機）*：
+
... 存取儲存陣列的命令列介面（CLI）。
... 在控制器上載入適當的單工 NVSRAM 。
+
例如： `download storageArray NVSRAM file=\"N4000-881834-SG4.dlp\" forceDownload=TRUE;`

... 載入單工 NVSRAM 後、確認控制器為 * 最佳 * 。
... 如果使用外部安全金鑰管理， https://docs.netapp.com/us-en/e-series/upgrade-controllers/upgrade-unlock-drives-task.html#external-key-management["在控制器上設定外部金鑰管理"]。
... 如果使用內部安全金鑰管理、請輸入下列命令以匯入安全金鑰：
+
[listing]
----
import storageArray securityKey file="C:/file.slk"
passPhrase="passPhrase";
----
+
其中：

+
**** 「C：/file.slk」代表磁碟機安全金鑰的目錄位置和名稱
**** `passPhrase`是解除鎖定檔案所需的密碼。在匯入安全金鑰之後，控制器會重新開機，而新控制器會採用儲存陣列的設定。


... 請前往下一個步驟、確認新的控制器處於最佳狀態。


** *混合使用安全和不安全的磁碟機*：
+
... 收集支援產品組合、然後開啟儲存陣列設定檔。
... 尋找並記錄所有不安全磁碟機的位置、這些位置可在支援套裝組合中找到。
... 關閉系統電源。
... 移除不安全的磁碟機。
... 更換控制器。
... 開啟系統電源。
... 從 SANtricity 系統管理員中、選取 * 設定›系統 * 。
... 在安全金鑰管理區段中、選取*建立/變更金鑰*以建立新的安全金鑰。
... 選取*解除鎖定安全磁碟機*以匯入您儲存的安全金鑰。
... 執行「show allDrives nativeState」CLI命令。
... 控制器將自動重新開機。
... 等待控制器開機、並讓七段顯示器顯示紙匣號碼或快閃L5。
... 關閉系統電源。
... 重新安裝不安全的磁碟機。
... 使用SANtricity 《Sytricity System Manager》重設控制器。
... 開啟系統電源、並等待七段顯示器顯示紙匣編號。
... 請前往下一個步驟、確認新的控制器處於最佳狀態。




. 在「系統管理程式」中、確認新的控制器是最佳的。SANtricity
+
.. 選取*硬體*。
.. 對於控制器機櫃、請選取*顯示機櫃背面*。
.. 選取您更換的控制器容器。
.. 選取*檢視設定*。
.. 確認控制器的*狀態*為最佳狀態。
.. 如果狀態不是「最佳」、請反白顯示控制器、然後選取*「線上放置」*。


. 使用SANtricity NetApp System Manager收集儲存陣列的支援資料。
+
.. 選擇 * 支援›支援中心› * 診斷 * 。
.. 選擇*收集支援資料*。
.. 按一下「* Collect*」。
+
檔案會以* support-data.7z*的名稱儲存在瀏覽器的「下載」資料夾中。





--
.將控制器置於線上（雙工）
--
.步驟
. 將替換控制器安裝到設備中。
+
.. 翻轉控制器、使可拆式護蓋面朝下。
.. 將CAM握把放在開啟位置、將控制器完全滑入產品。
.. 將CAM握把往左移動、將控制器鎖定到位。
.. 更換纜線。
.. 如果原始控制器使用DHCP作為IP位址、請在替換控制器背面的標籤上找到MAC位址。請網路管理員將您移除的控制器的DNS/網路和IP位址與更換控制器的MAC位址建立關聯。
+

NOTE: 如果原始控制器未將DHCP用於IP位址、則新控制器會採用您移除的控制器IP位址。



. 將控制器置於線上。
+
.. 在 System Manager 中，瀏覽至 * 硬體 * 頁面。
.. 選擇*顯示控制器背面*。
.. 選取更換的控制器。
.. 從下拉式清單中選取*線上放置*。


. 控制器開機時、請檢查控制器LED。
+
** 除非發生錯誤、否則控制器上的黃色警示LED會開啟然後關閉。
** 主機連結LED可能會亮起、閃爍或關閉、視主機介面而定。


. 當控制器重新連線時、請確認其狀態為最佳、並檢查控制器機櫃的注意LED。
+
如果狀態不是最佳、或是有任何警示LED亮起、請確認所有纜線都已正確安裝、且控制器機箱已正確安裝。如有必要、請移除並重新安裝控制器容器。

+

NOTE: 如果您無法解決問題、請聯絡技術支援部門。

. 如有需要、請使用SANtricity NetApp System Manager將所有磁碟區重新分配給偏好的擁有者。
+
.. 選擇 * 儲存› Volumes （磁碟區） * 。
.. 選擇 * 更多›重新分配 Volume * 。


. 按一下 * 硬體›支援›升級中心 * ，確保已安裝最新版本的 SANtricity OS 軟體（控制器韌體）。
+
視需要安裝最新版本。

. 使用SANtricity NetApp System Manager收集儲存陣列的支援資料。
+
.. 選擇 * 支援›支援中心›診斷 * 。
.. 選擇*收集支援資料*。
.. 按一下「* Collect*」。
+
檔案會以* support-data.7z*的名稱儲存在瀏覽器的「下載」資料夾中。





--
====
.接下來呢？
您的控制器更換已完成。您可以恢復正常作業。
