---
permalink: config-vmware/iscsi-perform-specific-task.html 
sidebar: sidebar 
keywords: iscsi, express vmware configuration, software configuration, vmware host, E2800, E5700, EF300, EF600, E-Series, eseries 
summary: 對於iSCSI傳輸協定、您可以在陣列端和主機端設定交換器和網路。然後驗證IP網路連線。 
---
= 在 E 系列 - VMware 中執行 iSCSI 專屬工作
:allow-uri-read: 
:experimental: 
:icons: font
:imagesdir: ../media/


[role="lead"]
對於iSCSI傳輸協定、您可以在陣列端和主機端設定交換器和網路。然後驗證IP網路連線。



== 步驟1：設定交換器- iSCSI、VMware

您可以根據廠商的iSCSI建議來設定交換器。這些建議可能同時包含組態指令和程式碼更新。

.開始之前
請確定您擁有下列項目：

* 兩個獨立的網路提供高可用度。請確定您將iSCSI流量隔離至不同的網路區段。
* 已啟用「傳送及接收硬體流程控制*端點對端點*」。
* 停用優先順序流程控制。
* 如果適用、請啟用巨型框架。



NOTE: 控制器的交換器連接埠不支援連接埠通道/LACP。不建議使用主機端LACP；多重路徑可提供相同或更好的效益。

.步驟
請參閱交換器廠商的文件。



== 步驟2：設定網路功能- iSCSI VMware

您可以根據資料儲存需求、以多種方式設定iSCSI網路。如需為環境選擇最佳組態的秘訣、請洽詢您的網路管理員。

.開始之前
請確定您擁有下列項目：

* 已啟用「傳送及接收硬體流程控制*端點對端點*」。
* 停用優先順序流程控制。
* 如果適用、請啟用巨型框架。
+
如果您基於效能考量而在IP SAN中使用巨型框架、請務必將陣列、交換器和主機設定為使用巨型框架。如需如何在主機和交換器上啟用巨型框架的資訊、請參閱作業系統和交換器文件。若要在陣列上啟用巨型框架、請完成步驟3中的步驟。



.關於這項工作
規劃 iSCSI 網路時，請記住本 https://configmax.broadcom.com/home["VMware組態上限"^]指南指出支援的 iSCSI 儲存路徑上限為 8 條。您必須考量此需求、以免設定太多路徑。

根據預設、當您不使用iSCSI連接埠繫結時、VMware iSCSI軟體啟動器會針對每個iSCSI目標建立單一工作階段。


NOTE: VMware iSCSI連接埠繫結是一項功能、可強制所有繫結的VMkernel連接埠登入已設定網路區段上可存取的所有目標連接埠。它用於提供iSCSI目標單一網路位址的陣列。NetApp建議不要使用iSCSI連接埠繫結。如需其他資訊，請參閱文章，瞭 https://support.broadcom.com/["VMware知識庫"]解在 ESX/ESXi 中使用軟體 iSCSI 連接埠繫結的相關考量。如果ESXi主機連接至其他廠商的儲存設備、NetApp建議您使用個別的iSCSI vmkernel連接埠、以避免與連接埠繫結發生衝突。

為達最佳實務做法、您不應在E系列儲存陣列上使用連接埠繫結。如需詳細資訊、請參閱 https://www.netapp.com/media/17017-tr4789.pdf["TR-4789 ：適用於 E 系列 SANtricity iSCSI 的 VMware 組態指南、可與 ESXi 6.x 和 7.x 整合"^] 。

為確保良好的多重路徑組態、iSCSI網路可使用多個網路區段。在一個網路區段上、至少放置一個主機端連接埠和每個陣列控制器的一個連接埠、並在另一個網路區段上放置一組相同的主機端連接埠和陣列端連接埠。如有可能、請使用多個乙太網路交換器來提供額外的備援。

.步驟
請參閱交換器廠商的文件。


NOTE: 許多網路交換器必須設定在超過9、000位元組的IP負荷上。如需詳細資訊、請參閱交換器文件。



== 步驟3：設定陣列端的網路功能- iSCSI、VMware

您可以使用SANtricity 支援支援系統的圖形使用者介面、在陣列端設定iSCSI網路。

.開始之前
請確定您擁有下列項目：

* 其中一個儲存陣列控制器的IP位址或網域名稱。
* 系統管理員GUI的密碼、或角色型存取控制（RBAC）或LDAP及目錄服務的密碼、已設定為適當的儲存陣列安全存取。如SANtricity 需存取管理的詳細資訊、請參閱《支援系統》線上說明。


.關於這項工作
本工作說明如何從「硬體」頁面存取iSCSI連接埠組態。您也可以從功能表：系統[設定>設定iSCSI連接埠]存取組態。


NOTE: 有關如何在 VMware 組態上設定陣列端網路的其他資訊，請參閱下列技術報告： https://www.netapp.com/pdf.html?item=/media/17017-tr4789pdf.pdf["《VMware組態指南：E系列SANtricity 的iSCSI與ESXi 6.x和7.x整合》"^]。

.步驟
. 在瀏覽器中輸入下列URL：「+https://<DomainNameOrIPAddress>+`」
+
「IPAddress」是其中一個儲存陣列控制器的位址。

+
第一次SANtricity 在尚未設定的陣列上開啟時、會出現「Set Administrator Password（設定管理員密碼）」提示字元。角色型存取管理可設定四種本機角色：管理、支援、安全性及監控。後三個角色的隨機密碼是無法猜測的。設定管理員角色的密碼之後、您可以使用管理員認證來變更所有密碼。如SANtricity 需四種本機使用者角色的詳細資訊、請參閱《支援系統》線上說明。

. 在Set Administrator Password（設定管理員密碼）和Confirm Password（確認密碼）欄位中輸入管理員角色的System Manager密碼、然後按一下* Set Password（設定密碼）*。
+
如果未設定集區、磁碟區群組、工作負載或通知、則會啟動設定精靈。

. 關閉設定精靈。
+
稍後您將使用精靈來完成其他設定工作。

. 選取*硬體*。
. 如果圖形顯示磁碟機、請按一下*顯示磁碟櫃背面*。
+
圖形會變更、以顯示控制器而非磁碟機。

. 按一下要設定iSCSI連接埠的控制器。
+
此時會出現控制器的內容功能表。

. 選取*設定iSCSI連接埠*。
+
此時將打開Configure iSCSI Portes（配置iSCSI端口）對話框。

. 在下拉式清單中、選取您要設定的連接埠、然後按一下「*下一步*」。
. 選取組態連接埠設定、然後按一下「*下一步*」。
+
若要查看所有連接埠設定、請按一下對話方塊右側的*顯示更多連接埠設定*連結。

+
|===
| 連接埠設定 | 說明 


 a| 
已設定乙太網路連接埠速度
 a| 
選取所需的速度。下拉式清單中顯示的選項取決於網路可支援的最大速度（例如10 Gbps）。


NOTE: 控制器上提供的選購25GB iSCSI主機介面卡不會自動交涉速度。您必須將每個連接埠的速度設定為10 GB或25 GB。所有連接埠都必須設定為相同的速度。



 a| 
啟用IPV4 /啟用IPv6
 a| 
選取一個或兩個選項、以啟用對IPv4和IPv6網路的支援。



 a| 
TCP接聽連接埠（按一下*顯示更多連接埠設定*即可取得）。
 a| 
如有必要、請輸入新的連接埠號碼。

接聽連接埠是控制器用來接聽來自主機iSCSI啟動器之iSCSI登入的TCP連接埠號碼。預設的接聽連接埠為3260。您必須輸入3260或49152到65535.之間的值。



 a| 
MTU大小（按一下*顯示更多連接埠設定*即可取得）。
 a| 
如有必要、請為最大傳輸單元（MTU）輸入新的位元組大小。

預設的最大傳輸單元（MTU）大小為每個框架1500位元組。您必須輸入介於1500和9000之間的值。



 a| 
啟用ICMP Ping回應
 a| 
選取此選項可啟用網際網路控制訊息傳輸協定（ICMP）。網路電腦的作業系統會使用此傳輸協定來傳送訊息。這些ICMP訊息可判斷主機是否可連線、以及從該主機取得封包所需的時間。

|===
+
如果您選取*啟用IPV4、則會在您按一下*下一步*之後、開啟一個對話方塊、供您選取IPV4設定。如果您選取*啟用IPv6 *、則會在您按一下*下一步*之後、開啟一個對話方塊來選取IPv6設定。如果您同時選取這兩個選項、則會先開啟[IPV4設定]對話方塊、然後按一下[* Next*（*下一步*）]之後、隨即開啟[IPv6設定]對話方塊。

. 自動或手動設定IPv6和/或IPv6設定。若要查看所有連接埠設定、請按一下對話方塊右側的*顯示更多設定*連結。
+
|===
| 連接埠設定 | 說明 


 a| 
自動取得組態
 a| 
選取此選項可自動取得組態。



 a| 
手動指定靜態組態
 a| 
選取此選項、然後在欄位中輸入靜態位址。對於IPV4、請加入網路子網路遮罩和閘道。對於IPv6、請包含可路由的IP位址和路由器IP位址。

|===
. 單擊*完成*。
. 關閉System Manager。




== 步驟4：設定主機端網路功能- iSCSI

在主機端設定iSCSI網路功能可讓VMware iSCSI啟動器與陣列建立工作階段。

.關於這項工作
在主機端設定iSCSI網路的這種快速方法中、您可以讓ESXi主機將iSCSI流量傳輸到四個備援路徑上的儲存設備。

完成此工作之後、主機會設定一個vSwitch、其中包含VMkernel連接埠和兩個vmnics。

如需設定VMware iSCSI網路的其他資訊、請參閱 https://docs.vmware.com/en/VMware-vSphere/index.html["VMware vSphere文件"^] 適用於您的vSphere版本。

.步驟
. 設定用於傳輸iSCSI儲存流量的交換器。
. 啟用「傳送及接收硬體流程控制*端點對端點*」。
. 停用優先順序流程控制。
. 完成陣列端iSCSI組態。
. 使用兩個NIC連接埠進行iSCSI流量。
. 使用vSphere用戶端或vSphere Web用戶端來執行主機端組態。
+
介面功能各不相同、實際工作流程也各不相同。





== 步驟5：驗證IP網路連線- iSCSI、VMware

您可以使用ping測試來驗證網際網路傳輸協定（IP）網路連線、以確保主機和陣列能夠通訊。

.步驟
. 視是否啟用巨型框架而定、在主機上執行下列其中一個命令：
+
** 如果未啟用巨型框架、請執行下列命令：
+
[listing]
----
vmkping <iSCSI_target_IP_address\>
----
** 如果啟用巨型框架、請執行有效負載大小為8、972位元組的ping命令。IP和ICMP的合併標頭為28個位元組、新增至有效負載時、等於9、000個位元組。s交換器會設定「封包大小」位元。d交換器會在IPV4封包上設定DF（請勿分段）位元。這些選項可在iSCSI啟動器與目標之間成功傳輸9、000個位元組的巨型框架。
+
[listing]
----
vmkping -s 8972 -d <iSCSI_target_IP_address\>
----
+
在此範例中、iSCSI目標IP位址為「192.0.2.8」。

+
[listing]
----
vmkping -s 8972 -d 192.0.2.8
Pinging 192.0.2.8 with 8972 bytes of data:
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Ping statistics for 192.0.2.8:
  Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
  Minimum = 2ms, Maximum = 2ms, Average = 2ms
----


. 從每個主機的啟動器位址（用於iSCSI的主機乙太網路連接埠IP位址）、發出「vmkping」命令至每個控制器iSCSI連接埠。從組態中的每個主機伺服器執行此動作、視需要變更IP位址。
+

NOTE: 如果命令失敗並顯示訊息「傳送失敗（訊息太長）」、請確認主機伺服器、儲存控制器和交換器連接埠上乙太網路介面的MTU大小（巨型框架支援）。

. 返回iSCSI組態程序以完成目標探索。




== 步驟6：記錄您的組態

您可以產生及列印本頁的PDF、然後使用下列工作表記錄您的傳輸協定專屬儲存組態資訊。您需要這些資訊來執行資源配置工作。



=== 建議的組態

建議的組態包括兩個啟動器連接埠、以及四個具有一或多個VLAN的目標連接埠。

image::../media/50001_01_conf-vmw.gif[iSCSI 連接埠識別碼]



=== 目標IQN

|===
| 標註編號 | 目標連接埠連線 | IQN 


 a| 
2.
 a| 
目標連接埠
 a| 

|===


=== 對應主機名稱

|===
| 標註編號 | 主機資訊 | 名稱與類型 


 a| 
1.
 a| 
對應主機名稱
 a| 



 a| 
 a| 
主機作業系統類型
 a| 

|===